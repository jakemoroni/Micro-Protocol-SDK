# Copyright (C) 2022 Jacob Moroni (opensource@jakemoroni.com).
# SPDX-License-Identifier: GPL-3.0-or-later
# Makefile to build the Micro Protocol PC utilities.

UTILS		:= mp_query mp_console mp_update
CFLAGS		:= -Wall -MMD -MP

BUILD_DIR	:= ./build
SRC_DIR		:= ./src

all: $(UTILS)

$(UTILS): %: $(SRC_DIR)/%.c | $(BUILD_DIR)
	@$(CC) $(CFLAGS) -o $@ $< -MF $(BUILD_DIR)/$@.d

$(BUILD_DIR):
	@mkdir $@

.PHONY: clean
clean:
	@rm -rf $(BUILD_DIR) $(UTILS)

# Incorporate header deps, generated by GCC with -MMD -MP.
-include $(UTILS:%=$(BUILD_DIR)/%.d)